/*
 * Media Slider - jQuery Plugin
 * version: 0.2.1 (17/02/2012)
 * @requires jQuery v1.7 or later
 *
 * Examples at http://github.com/pkolt/jquery-slider
 * License: GPL 2.0
 *
 * Copyright 2012 Pavel Koltyshev - pkolt@mail.ru
 *
 */
(function(b){var a=b.slider=function(){};b.extend(a,{version:"0.2.1",defaults:{autoPlay:false,showTitle:false,buttonPrev:null,buttonNext:null,speedIn:500,speedOut:500,interval:3000,source:null},options:{},tmpl:{img:'<div style="visibility:hidden;"><img><span></span></div>',nav:'<ul style="display:none"></ul>',navItem:'<li><a href="#"></a></li>'},sel:{slider:".md-slider",source:".md-slider-source",nav:".md-slider-nav",img:".md-slider-img"},autoload:function(c){b(a.sel.slider).slider(c)},play:function(c){c.delay(c.options.interval).queue(function(){a.next(c);b(this).dequeue()}).queue(function(){a.play(c);b(this).dequeue()})},stop:function(c){c.clearQueue();c.stop()},next:function(c){var d=a._getImgIndex(c);if(d<a._getImgs(c).size()){a.jumpto(c,d+1)}else{a.first(c)}},prev:function(c){var d=a._getImgIndex(c);if(d>0){a.jumpto(c,d-1)}else{a.last(c)}},first:function(c){a.jumpto(c,1)},last:function(c){a.jumpto(c,a._getImgs(c).size())},jumpto:function(c,d){var e=c.find(a.sel.img).eq(d-1);c.find(a.sel.img+".show").removeClass("show").fadeOut(c.options.speedOut);e.addClass("show").fadeIn(c.options.speedIn);a._changeNavItem(c)},_init:function(c,d){d=d||{};d=c.options=b.extend(a.defaults,d);var e=d.source;if(!b.isArray(e)){if(!e){e=a.sel.source}e=a._parseSource(c,e)}if(e){a._preload(c,e);a._createNav(c,e)}},_parseSource:function(c,e){var d=c.find(e).first();if(d.size()){d.hide();return b.map(d.find("li"),function(l,j){var f=b(l).find("a:first"),g=b.trim(f.attr("href")),k=b.trim(f.attr("title")),h=b.trim(f.html());return g?{url:g,title:k,html:h}:null})}return false},_createNav:function(c,e){var f=b(a.tmpl.nav);var d=a.sel.nav.slice(1,a.sel.nav.length);f.addClass(d);b.each(e,function(h,i){var g=b(a.tmpl.navItem);g.click({sl:c},function(j){a.stop(c);a.jumpto(j.data.sl,h+1);return false});f.append(g)});c.append(f)},_changeNavItem:function(c){var e=c.find(a.sel.nav);var d=a._getImgIndex(c)-1;e.find("a").removeClass("hole");e.find("li:eq("+d+")").find("a").addClass("hole")},_preload:function(d,f){var e=d.width(),c=d.height(),g=a.sel.img.slice(1,a.sel.img.length);b.each(f,function(j,k){var i=b(a.tmpl.img),h={width:e,height:c,src:k.url};i.css({width:e,height:c}).attr("class",g);if(k.html&&d.options.showTitle){i.find("span").html(k.html)}if(k.title){b.extend(h,{title:k.title})}i.find("img").attr(h).load({sl:d},function(l){a._eventPreloadFinish(l.data.sl,l)});d.append(i)})},_eventPreloadFinish:function(c,e){var d=b(e.target).parent();d.css("visibility","visible").hide().addClass("finished");if(d.index()==1){a.jumpto(c,1)}else{if(a._isFinishedPreload(c)){a._eventPreloadAllFinish(c)}}},_eventPreloadAllFinish:function(c){if(c.options.buttonPrev){b(c.options.buttonPrev).click({sl:c},function(d){a.stop(c);a.prev(d.data.sl);return false}).show()}if(c.options.buttonNext){b(c.options.buttonNext).click({sl:c},function(d){a.stop(c);a.next(d.data.sl);return false}).show()}b(a.sel.img+".show").live("click",{sl:c},function(d){a.stop(c);a.next(d.data.sl);return false});c.find(a.sel.nav).show();if(c.options.autoPlay){a.play(c)}},_isFinishedPreload:function(c){var d=a._getImgs(c);var e=d.filter(".finished");return d.size()-e.size()==0},_getImgs:function(c){return c.find(a.sel.img)},_getImgIndex:function(c){return c.find(a.sel.img+".show").first().index()}});b.fn.slider=function(c){a._init(this,c);return this}})(jQuery);